---

docker_opts: "--dns=192.168.33.66"

internal_mesos_url: "http://demo.local:{{ mesos_leader_port }}"
internal_marathon_url: "http://demo.local:{{ marathon_port }}"

python_location: '/usr/bin/python3'
python_pip: '/usr/bin/pip3'

airflow_scheduler_cpus: 0.2
airflow_scheduler_mem: 2560.0
airflow_webserver_cpus: 0.2
airflow_webserver_mem: 512.0

airflow_web_server_port: 4080
airflow_web_server_host: '0.0.0.0'
airflow_web_base_url: "http://demo:14080"

airflow_db_host: "demo"
airflow_db_port: 4321
airflow_sql_alchemy_conn: "postgresql://airflow:{{ airflow_db_password }}@{{ airflow_db_host }}:{{ airflow_db_port }}/airflow"

airflow_scripts_root: '/opt/airflow-scripts'
airflow_scripts_verify_commit: false

airflow_load_examples: false

airflow_user: 'airflow'
airflow_group: 'airflow'
airflow_home: '/usr/local/airflow'
airflow_startup: 'marathon'
airflow_mesos_master: 'demo:5050'
airflow_db_databases: "airflow,data_catalog,i2b2,mipmap"

airflow_pool_io_intensive: 1
airflow_pool_remote_file_copy: 1
airflow_pool_image_preprocessing: 1

data_catalog_db_deploy: no
data_catalog_db_host: '{{ airflow_db_host }}'
data_catalog_db_port: '{{ airflow_db_port }}'
data_catalog_db_sql_alchemy_conn: "postgresql://data_catalog:{{ data_catalog_db_password }}@{{ data_catalog_db_host }}:{{ data_catalog_db_port }}/data_catalog"

i2b2_db_deploy: no
i2b2_db_host: '{{ airflow_db_host }}'
i2b2_db_port: '{{ airflow_db_port }}'
i2b2_db_sql_alchemy_conn: "postgresql://i2b2:{{ i2b2_db_password }}@{{ i2b2_db_host }}:{{ i2b2_db_port }}/i2b2"

mipmap_db_deploy: no
mipmap_db_host: '{{ airflow_db_host }}'
mipmap_db_port: '{{ airflow_db_port }}'

# Configuration for MRI preprocessing pipeline running in Airflow
data_factory_datasets: 'main'
data_factory_email_errors_to: ''
data_factory_slack_channel: '#data'
data_factory_slack_channel_user: 'Airflow'

main_dataset_label: 'Demo'
main_preprocessing_input_config: 'boost'
main_preprocessing_max_active_runs: 30
main_preprocessing_scanners: 'flat'
main_preprocessing_pipelines: 'dicom_organizer,dicom_selection,dicom_to_nifti,mpm_maps,neuro_morphometric_atlas,export_features'
main_preprocessing_input_folder: "/data/demo"
main_preprocessing_min_free_space: 0.3
main_preprocessing_copy_to_local: "/data/incoming"
main_preprocessing_images_organiser_output_folder_structure: 'PatientID:AcquisitionDate:SeriesDescription:SeriesDate'
main_preprocessing_dicom_organiser_docker_image: 'hbpmip/hierarchizer'
main_preprocessing_dicom_organiser_version: '{{ hierarchizer_version }}'
main_preprocessing_dicom_organiser_input_folder: "/data/organizer"
main_preprocessing_dicom_organiser_output_folder: "/data/organizer"
main_preprocessing_dicom_organiser_data_structure: "{{ main_preprocessing_images_organiser_output_folder_structure }}"
main_preprocessing_nifti_organiser_docker_image: 'hbpmip/hierarchizer'
main_preprocessing_nifti_organiser_version: '{{ hierarchizer_version }}'
main_preprocessing_nifti_organiser_input_folder: "/data/organizer"
main_preprocessing_nifti_organiser_output_folder: "/data/organizer"
main_preprocessing_nifti_organiser_data_structure: "{{ main_preprocessing_images_organiser_output_folder_structure }}"
main_preprocessing_dicom_selection_output_folder: '/data/images_selection'
main_preprocessing_dicom_selection_images_selection_csv_path: "{{ main_preprocessing_copy_to_local }}/images_selection.csv"
main_preprocessing_nifti_selection_output_folder: '/data/images_selection'
main_preprocessing_nifti_selection_images_selection_csv_path: "{{ main_preprocessing_copy_to_local }}/images_selection.csv"
main_preprocessing_dicom_select_T1_output_folder: "/data/select_T1"
main_preprocessing_dicom_select_T1_protocols_definition_file: "{{ airflow_scripts_root }}/mri-preprocessing-pipeline/Protocols_definition.txt"
main_preprocessing_nifti_local_folder: "/data/nifti"
main_preprocessing_mpm_maps_local_folder: "/data/mpm_maps"
main_preprocessing_neuro_morphometric_atlas_local_folder: "/data/neuro_morphometric_atlas"
main_preprocessing_pipelines_path: "{{ airflow_scripts_root }}/mri-preprocessing-pipeline/Pipelines"
main_preprocessing_protocols_file: "{{ airflow_scripts_root }}/mri-preprocessing-pipeline/Protocols_definition.txt"
main_etl_input_config: "{{ main_preprocessing_input_config }}"
main_etl_ehr_scanners: 'flat'
main_etl_ehr_data_folder: '/data/ehr_demo'
main_etl_ehr_data_folder_depth: 0
main_etl_ehr_versioned_folder: '/data/ehr_versioned'
main_etl_ehr_to_i2b2_capture_docker_image: "hbpmip/mipmap-demo-ehr-to-i2b2:{{ ehr_to_i2b2_capture_version }}"
main_etl_ehr_to_i2b2_capture_folder: '/data/ehr_i2b2_capture'

airflow_work_dirs:
  - '{{ main_preprocessing_dicom_local_folder }}'
  - '{{ main_preprocessing_dicom_organizer_local_folder }}'
  - '{{ main_preprocessing_images_selection_local_folder }}'
  - '{{ main_preprocessing_dicom_select_T1_local_folder }}'
  - '{{ main_preprocessing_nifti_local_folder }}'
  - '{{ main_preprocessing_mpm_maps_local_folder }}'
  - '{{ main_preprocessing_neuro_morphometric_atlas_local_folder }}'

spm_dir: "/opt/spm12"
